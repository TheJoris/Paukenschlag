\section{On a new and simple Brownian Dynamics algorithm for eGFRD}

\subsection{Introduction}

\subsubsection{Reversible reactions}
We want to design a simple Brownian dynamics (BD) algorithm for simulating second order chemical reactions of the form
\begin{equation}
{\rm A} + {\rm B} \rates{k_{\rm on}}{k_{\rm off}} {\rm C}
\end{equation}
where two particle A and B can form a complex with the macroscopic forward rate $k_{\rm on}$. This complex can decay into the particles A and B again with the backward rate $k_{\rm off}$. In a spatially resolved model we can decompose this reaction into two steps \cite{Agmon1990}
\begin{equation}
{\rm A} + {\rm B} \rates{k_{\rm D}}{k_{\rm D,b}} A \cdots B \rates{k_{\rm a}}{k_{\rm d}} {\rm C}.
\end{equation}
From left to right this equation describes the diffusive movement of the particles toward each other with a rate $k_D$, forming the intermediate state $A \cdots B$ with the particles in contact, and then, can form a complex C with the intrinsic association rate $k_a$. The equation in reverse reads: the dissociation of the complex C to the intermediate state with an intrinsic dissociation rate $k_d$, and the diffusion of the particles into the bulk with a rate $k_{D,b}$. In equilibrium, the intrinsic rates $k_a$ and $k_d$ are related to the macroscopic rates $k_{\rm on}$ and $k_{\rm off}$ via the detailed-balance relation
\begin{equation}
K_{eq} = \frac{k_{\rm on}}{k_{\rm off}} = \frac{k_{\rm a}}{k_{\rm d}}.
\end{equation}

\subsubsection{General idea}
The algorithm needs to simulate both the formation and destruction of the intermediate complex $A\cdots B$ by diffusion. Furthermore, when two particles formed an intermediate complex or are 'at contact', we need to determine the probability by which they react. We discretize time in steps of $\Delta t$, and each timestep, all particles can make a move using the free propegator of Brownian motion. In order to react, every particle has a spherical region with thickness $\delta$ around it, called the \emph{reaction volume}. When a particle is inside the reaction volume of another particle after making a move, it can react with a certain probability. We derive this probability using detailed balance. A schematical representation of our scheme is in \fref{BDReactions}.

\begin{figure}[ht]
\centering
\includegraphics[scale=.5]{BDReactions2}
\caption{\flabel{BDReactions} The process of a bimolecular reaction in our scheme in 2D as viewed by particle A. This particle has an annulus shaped reaction volume with inner radius $\sigma_A + \sigma_B$ and the outer radius a length $\delta$ larger. The two particles form an intermediate complex when the center of mass of particle B moves inside the reaction volume of particle A. The particles can than react to form a complex with a probability proportional to the intrinsic association rate $k_a$. In reverse, a complex dissociates with a rate $k_d$ into an intermediate complex, whereafter the product particles can diffuse away.}
\end{figure}
 
\subsection{Detailed balance}

The key principle we want to enforce with our algorithm is the detailed balance relation between the unbound state of an isolated pair of particles and their bound state when the particles form a complex, given that the system is in equilibrium. We denote the unbound state by the probability density function $P_u(\vec{r})$, which gives the probability density that two particles A and B are separated by an inter-particle vector $\vec{r}$. The probability for the particles to be in the bound state C is $P_b$. The detailed balance relation between these two states is
\begin{equation}
 P_{ \rm{u} }(\vec{r})d\vec{r} \,\, P_{ \rm{u} \to \rm{b} }(\vec{r}) = P_{ \rm{b} } \,\, P_{ \rm{b} \to \rm{u} }(\vec{r})d\vec{r}
\elabel{DBeqn}
\end{equation}
where $P_{ \rm{u} \to \rm{b} }(\vec{r})$ is the transition probability for the unbound state to change into the bound state, called the forward move, and $P_{ \rm{b} \to \rm{u}}(\vec{r})d\vec{r}$ is the transition probability from the bound state to the unbound state, which is called the backward move. The explicit form of these functions will define how the forward and backward reactions take place in our BD scheme, and we will continue describing them. 

\subsubsection{Free movement}
In this analysis we will assume the A particle to be fixed at the origin, and every timestep $\Delta t$ the B particle diffuses around with diffusion constant $D$ in the d-dimensional space (d = 1,2 or 3) it lives in. The stepsize of the move is drawn from the free propagator of Brownian motion 
\begin{equation}
P^{\rm free}(\vec{r},\Delta t|\vec{r_0}) = \frac{1}{(4 \pi D \Delta t)^{d/2}}{\rm exp}(-\frac{(\vec{r}-\vec{r_0})^2}{4 D \Delta t}) 
\end{equation}
and the step direction is random. When the particle core of the particle overlaps with another core the move is rejected and the particle is placed at the original position. The full propagator to make a free move with possibly a bounce is thus
\begin{multline}
 P^{\rm move}(\vec{r},\Delta t|\vec{r_0}) = P^{\rm free}(\vec{r},\Delta t|\vec{r_0}) \, \theta(r - \sigma) \, + \\ \int_{V} d\vec{r'}P^{\rm free}(\vec{r'},\Delta t|\vec{r_0}) \, \theta(\sigma - r')\delta(\vec{r}-\vec{r_0}),
\elabel{move_prop}
\end{multline}
where $\sigma$ is sum of the radii of the particle pair, and $\theta(r - \sigma)$ the Heavyside- or step function. The probability distribution of the free propegator is cut off at distances smaller than $\sigma$ (core overlap) in the first term, and the total probability inside this area is placed at the starting position $r_0$ by the second term.

\subsubsection{Forward move}
Two particles can attempt a reaction when they lie in each other's {\it reaction volume}. The reactiom volume, denoted by $u^*$, is a spherical shell around each particle with a thickness $\delta$ and volume $V^*$. The reaction attempt is accepted with a probability $P^{\rm acc}_{{\rm u}^* \to {\rm b}}$. Thus, two particles initially in the unbound state $u$, separated by an inter-particle vector $\vec{r}$, move into the bound state $b$ with a probability
\begin{equation}
P_{ \rm{u} \to \rm{b} }(\vec{r}) = P^{\rm move}_{{\rm u} \to {\rm u}^*}({\rm u}^*,\Delta t|\vec{r}) P^{\rm acc}_{{\rm u}^* \to {\rm b}}.
\end{equation}
Here $P^{\rm move}_{{\rm u} \to {\rm u}^*}({\rm u}^*,\Delta t|\vec{r})$ gives the probability of ending up somewhere inside the reaction volume, given that you started at $\vec{r}$. Note that the particle could have started inside the reaction volume, such that $u^* \subset u$.

\subsubsection{Backward move}
The dissociation of a complex is modeled as a Poisson process, and can occur each timestep with a probability
\begin{equation}
 P^{\rm acc}_{\rm b \to u^*} = k_d \Delta t.
\end{equation}
When the dissociation is accepted, the products particles are placed a distance $r'$ apart, inside the reaction volume. Hereafter, the B particle make's a move from $\vec{r'}$ to $\vec{r}$ via the propegator in \eref{move_prop}. The total transition probability from the bound state $b$, via the intermediate state $u^*$, and ending in unbound state $u$ at $\vec{r}d\vec{r}$, is given by
\begin{equation}
P_{ \rm{b} \to \rm{u}}(\vec{r})d\vec{r} =  P^{\rm acc}_{b \to u^*}\,P^{\rm move}_{u^* \to u}(\vec{r},\Delta t|u^*)d\vec{r},
\end{equation}
The second factor gives the probability of ending up at $\vec{r}d\vec{r}$, given that you started inside $u^*$.

\subsubsection{Solving the detailed balance equation}
Now that we have defined both transition probabilities, we can solve the detailed balance equation (\eref{DBeqn}) for the acceptance probability of a forward move $P^{\rm acc}_{{\rm u}^* \to {\rm b}}$. We first use the important relation found in \cite{Morelli2008a} for a system in equilibrium
\begin{equation}
 \frac{P_b}{P_u(\vec{r})d\vec{r}} = \frac{K_{\rm eq}}{d\vec{r}} = \frac{k_a}{k_d d\vec{r}},
\end{equation}
such that we can write
\begin{equation}
 \frac{P_b}{P_u(\vec{r})d\vec{r}} = \frac{P_{ \rm{u} \to \rm{b} }(\vec{r})}{P_{ \rm{b} \to \rm{u} }(\vec{r})d\vec{r}} = \frac{k_a}{k_d d\vec{r}}.
\end{equation}
Substituting our definition for the transition probabilities in the last equality, we find
\begin{equation}
 \frac{P^{\rm acc}_{{\rm u}^* \to {\rm b}}}{P^{\rm acc}_{b \to u^*}} \: \frac{P^{\rm move}_{{\rm u} \to {\rm u}^*}({\rm u}^*,\Delta t|\vec{r})}{P^{\rm move}_{u^* \to u}(\vec{r},\Delta t|u^*)d\vec{r}} = \frac{k_a}{k_d d\vec{r}}.
\end{equation}
We show in \aref{newBD:fwdbwdeq}, that the movement steps in both the transition probabilities only differ by a factor $V^*$. The complicated propegators cancel, and we are left with
\begin{equation}
 \frac{P^{\rm acc}_{{\rm u}^* \to {\rm b}}}{k_d \Delta t/V^* \,\, d\vec{r}} = \frac{k_a}{k_d d\vec{r}}.
\elabel{semi-pivotal}
\end{equation}
Solving for the acceptance probability we find the principal result of our analysis
\begin{equation}
 P^{\rm acc}_{{\rm u}^* \to {\rm b}} = \frac{k_a \Delta t}{V^*}.
\elabel{pivotal}
\end{equation}
For a system with a concentration $\bar{c}$ of B particles, the average number of particles inside the reaction volume is $\bar{c}\,V^*$. Each iteraction of the alogrithm, the influx towards the bound state is $\bar{c}\,V^*\,P^{\rm acc}_{{\rm u}^* \to {\rm b}}$, which, accoring to our last result is equal to $\bar{c}\,k_a \Delta t$. 

\subsubsection{Relating $\mathbf{ P^{\rm acc}}$ with Green's functions}
Our result in \eref{pivotal} states the probability by which to react, given that you are in the reaction volume. In a non-discrete picture, the reaction between the particles is described using a Green's function with an radiation boundary condition; $p_{\rm rad}(\vec{r},t|\vec{r_0})$. The reactive flux towards the bound state is, by defenition of the radiation boundary, $k_a \, p_{\rm rad}(\sigma,t|\vec{r_0})$, where $\sigma$ is the sum of both particle radii and $k_a$ the intrinsic association rate. The probability that the particles are in contact or inside an infinite decimal thin shell around the reactive surface is $\Omega d\sigma \, p_{\rm rad}(\sigma,t|\vec{r_0})$, where $\Omega$ is the inner surface of the volume with thickness $d\sigma$. The influx into the bound state during a time $dt$, given that the particles are in contact, is \cite{Becker2011}
\begin{equation}
 P^{\rm acc}_{\rm Green's} = \frac{J_{\rm out}dt}{P({\rm inside\:\Omega d\sigma})} = \frac{k_a p_{\rm rad}(\sigma,t|\vec{r_0})dt}{\Omega d\sigma \, p_{\rm rad}(\sigma,t|\vec{r_0})} = \frac{k_a dt}{\Omega d\sigma}.
 \elabel{GFvsBD}
\end{equation}
The final expression is equal to \eref{pivotal} when we change the infinite decimal quantaties $dt$ and $d\sigma$ to the finite sizes $\Delta t$ and $\delta$. Our acceptance probability in Brownian dynamics is therefore a discretized version of the one used in a Green's function formalism such as \GFRD. 

\subsection{Interactions with structures}

\subsubsection{Interaction between particles and structures}
Apart from reactions between particles, we also want to simulate interactions between particles and structures such as rods and planes. By an interaction, we mean the binding of a particle from the bulk with a structure, after which it can diffuse one or two dimensionally on this structure. Vice versa, a particle can dissociate from a structure, and start diffusing three dimensionally in the bulk.

A particle can interact with a plane when the projection of it's center of mass lies in the plane and is separated less than a distance $\delta$. Wether the particle is inside the reaction volume or not only depends on the diffusion allong the axis perpendicular to the plane. Therefore, the interaction is essentially a 1D problem. Since the particle can interact with both sides of the plane, the reaction volume is $V^*=2 \delta$.

A particle can interact with a rod when the projection of it's c.o.m. lies on the central axis of the rod. This time, not the c.o.m., but the surface of the particle has to be within a distance $\delta$ of the surface of the rod to interact: $|{\bf r}_{\rm part}^{\rm c.o.m}-{\bf r}_{\rm rod}^{\perp}| \leq \sigma_{rod}+\sigma_{part} + \delta$. If the particle would interact with it's c.o.m., the cross section of the interaction would depend on the rod radius only, and the probability of the particle finding the rod would be very small. Especially when we model DNA, which has a very small radius indeed. If we look at the cross section through the particle, and perpendicular to the main axis of the rod, the problem is essentially a 2D diffusion-reaction problem. The reaction volume is thus an annulus, with inner radius $\sigma_{rod} + \sigma_{part}$, and the outer radius a $\delta$ longer.

\begin{figure}[ht]
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{BDGeometry_Plane}
\end{minipage}
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{BDGeometry_Rod}
\end{minipage}
\caption{\flabel{BDGeometry} Cross section through the center of mass of a particle (green) and the structure (blue). A particle can bind to a plane when the projected point of it's center of mass lies on the plane and the vector between these two points lies inside the reaction volume: ${\bf r}_{\rm perp}<\delta$. To interact with a rod, the projection of the center of mass of a particle has to lie on the central axis of the rod. Furthermore the vector between these two point has to satisfy ${\bf r_0} < \sigma_{rod} + \sigma_{part} + \delta$.}
\end{figure}


\subsubsection{Interaction between particles and particles on structures}
A particle living on a structure, which reacts with particles from the bulk, can have a complex reaction volume. For instance, a particle living on a rod, has a sphere minus a the cylinder protruding it as reaction volume. However, the surface of the particle on which reactions are possible, scales approximately with the same factor as the reaction volume. These factors cancel in the acceptance probability, and we can just use the 3D acceptance probability for any surface-bulk direct binding process
\begin{equation}
 P^{\rm acc}_{\rm direct\:binding} = \frac{k'_a \Delta t}{V'^*} \sim \frac{ \alpha 4 \pi \sigma^2 \tilde{k}_a \Delta t}{\alpha 4 \pi \sigma^2 \delta} \sim \frac{k_a \Delta t}{V^*}.
\end{equation}


\subsection{Algorithm outline}
Given is a simulation box containing structures and $N$ particles living either in the bulk (3D motion), on a plane (2D) or on a rot (1D) at time $t$. To propagate this system in time one timestep $\Delta t$, we start with generating a list of these particles in random order. We continue by propagating each particle sequentially in the order of the list. The propagation of a single particle can lead to the formation of a complex with another particle, or the dissociation of a complex in to two separate particles. 

The formation of a complex between particles A and B is simulated via:

\begin{enumerate}
\item Generate a trial displacement $\Delta x$ in each Cartesian coordinate the particle is allowed to move in with a length drawn from a Gaussian distribution with zero mean (or $v \Delta t$, in the case with drift) and standard deviation $\sqrt{2D\Delta t}$: $\vec{x}_{\rm new} = \vec{x}_{\rm old} + \Delta \vec{x}(D,v,\Delta t)$.
\item If the displacement leads to an overlap of the particle core with another particle's core, the move is rejected and the particle is placed at it's old position. If the center of mass of the particle crosses a plane, or shell overlaps with a rod, the move is also rejected. If none of the above is the case, the move is accepted and the particle is placed at it's new position.
\item Check if their are one or more particles or structures within the reaction volume. If their are one or more objects in the volume, attempt a reaction with each particle $i$ with an acceptance probability $P_{\rm acc}^i = k_{a}^i \Delta t/V_{\rm react, i}$. We assume the total acceptance probability always adds up to less than one. 
\item If an attempt is accepted, particles A and B are removed and a particle of type $C$ is placed at the center of mass between A and B. Both particles are also removed from the propagation sequence list. 
\end{enumerate}

The dissociation of a C particle into a geminate pair A and B, manifests itself via:

\begin{enumerate}
\item The dissociation of the complex can occur each timestep with a probability $k_d \Delta t$. If accepted, the C particle is replaced by an A and a B particle with the c.o.m. at the position of the C particle. The particles are placed at a random position with a uniform distribution inside the reaction volume.
\item After dissociation at least one particle can make a move using the free propagator. To fullfill detailed balance, the other particle only moves in 50 percent of the cases. 
\end{enumerate}
Continue with the next particle in the list until the list is empty.


\subsection{Correcting for the double reaction attempt}

\subsubsection{Forward move}
The algorithm described above simulates the particle dynamics sequentially. Thus, for a geminate pair, the number of reaction attempts per timestep will be greater than one: in case the first reaction attempt failed, the second particle is allowed to make another attempt. As a result, the influx into the bound state will be greater than derived above, and the acceptance probability has to be decreased to compensate for this. 

In the limit of small acceptance probabilities, the average number of moves per timestep made by the geminate pair is two. Given that the pair is in equilibrium, this means that there are made two equal reaction attempts as defined in the mathematical analysis above. Therefore, we divide the acceptance probability we found earlier (\eref{pivotal}) by two.

\subsubsection{Backward move}
In the backstep, after the decay products of the complex are placed in the reaction volume, they have to make a step with the free propagator in order for detailed balance to hold. This is because they made a diffusion step in the forward move prior to forming a complex. In the forward step either only one particle made a move and reacted, or both particles moved and the second particle reacted. In the limit of small acceptance probabilities, the first and second particle will initiate a reaction with equal probability, and the average number of moves made before reaction is one and a half. Therefore, in the backstep, we let one particle move and the other one with a 50 percent probability.

\subsubsection{Simultanious update}
A better solution to the double reaction attempt problem, is to first move all the particles in a random order, and than check for a reaction between all the particle pairs that lay inside a reaction volume. This way, we only check for a reaction once, and don't need to correct with a factor two. Furthermore, we can make the timestep $\Delta t$ larger because we don't need our acceptance probabilities to be small, allowing for a faster propegation. In the dissociation step, both particles move because we know for certain that both of them moved in the forward step. We did some simple simulation to show that this is indeed correct, but have not implemented it in \GFRD.


\subsection{Choosing the timestep for a multi domain in eGFRD}

\GFRD\, uses Brownian Dynamics when three or more particles are too close together to form a pair domain, and when seperate single domains would be inefficient. Here the algorithm forms a multi-domain: a connected set of spherical domains around each particle. Given such a domain, we want to choose the largest possible timestep while taking into account the following constraints
\begin{equation}
 \Delta t \leq \frac{(\alpha \sigma_{\rm min})^2 }{D_{max}}.
 \elabel{BDcntrI}
\end{equation}
and
\begin{equation}
 \frac{k_{a}^{max} \Delta t}{\delta} = \beta,
 \elabel{BDcntrII}
\end{equation}
Where $\sigma_{min}$ is the smallest particle radius and $D_{max}$ the maximum diffusion constant found in the multi domain. $k_{a}^{max}$ is the maximum intrinsic association rate of a bimolecular reaction possible in the multi, where we have divided out the surface factor ($[k_{a}^{max}] = Length/Time $).

The first constraint sets the average max stepsize to a fraction $\alpha$ of the minimal particle radius in the multi. This prohibits particles from stepping over other particles and makes sure the particle doesn't escape the multi with to great a step. The second constraint sets the highest acceptance probability in the multi equal to $\beta$. This to ensure that the correction made for the double reaction attempts is valid. 

We let the reaction length $\delta$ equal to $\alpha \, \sigma_{\rm min}$, or the maximal stepsize set in \eref{BDcntrI}. A particle will generate an escape event when it's reaction volume lies outside the multi domain. When a particle escapes, it underestimates the reaction probability because particles in a multi can, by design, only initiate reactions with other particles inside the same multi domain. Choosing $\delta$ this way we minimize this error while not decreasing the timestep below the constraint set in \eref{BDcntrI}.

In \GFRD\, we choose $\alpha = 0.05$ and $\beta = 0.01$.



\subsection{Tests}

\subsubsection{Testing the BD algorithm in two dimensions}

In this section we compare the dynamics of our algorithm with analytical results in the form of Green's functions. To show that our algorithm enables us to simulate 2D diffusion and reaction systems, we simulate a system on a plane with one particle fixed at the origin and one particle starting at contact with it at a random angle. We propegate the particle for a certain time $t_{\rm sim}$ and record it's position when this time is reached. The reaction between the particles is irreversibe, $A + B \to C$, such that when the particle reacts the simulation is stopped. To check the dependance of the dynamics on the used timestep, we run four simulations with the same number of iterations of the algorithm, but different values of the timestep. Results and details are in \fref{newBD2D_rdens_compare}, left. For large values of the timestep, the algorithm underestimates the survival probability. This error was expected because we derived the acceptance probability under the assumption the system is in equilibrium. Here however, we simulate a non-equilibrium system and the algorithm will converge to the analytical result for $\Delta t \to 0$ and $\delta \to 0$.

\begin{figure}[ht]
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{newBD2D_rdens_compare}
\end{minipage}
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{newBD1D_pbound_default}
\end{minipage}
\caption{\flabel{newBD2D_rdens_compare} {\bf Left}: Radial probability distribution for a pair of irreversibly reacting particles on a plane (2D). The four curves refer to different $t_{\rm sim}$ and where obtainded using timesteps  $\Delta t = 10^{-4} t_{\rm sim}$. Except for $t_{\rm sim} = .1\,\tau$, where we used $10^{-5} \tau$. Here, $\tau = R^2/D$, where $R=\sigma_A+\sigma_B$, the sum of the particle radii. The reaction length was set to $\delta=0.01 R$. Only the B particle moves with diffusion constant $D$, and starts at contact: $r_0=R$. The intrinsic association rate was set to $k_a = 100 R^2/\tau$. We compare simulation results (symbols) with a Green's function in 2D with a radiation boundary at radius $R$: $p_{\rm rad}(r,t|R)$ (lines) \cite{Beck1992}. The inset shows the simulation results with $t_{\rm sim} = .1\,\tau$, against a linear axis, for different values of the timestep. Using larger timesteps, the algorithm underestimates the survival probability.
{\bf Right}: Comparison between simulation and theory of the average occupancy of the complex state. The simulation is done in a 1D domain with length $L=20 R$ and timestep $\Delta t = 10^{-4} \tau$, where one particle is fixed at the origin and one particle is allowed to move. The intrinsic dissociation rate was set at $k_d=.1/\tau$, and we varied the association rate. The plot shows excellent agreement with the mean field prediction (\eref{occupancy_ana}). When we place the particles at contact after dissociation (cubes), and break detailed balance, the occupancy of the complex state is overestimated, as is clear for occupancies above 0.5. The inset shows the average occupancy for simulations performed with different size of the timestep. Although the dynamics for large timesteps will be wrong, the equilibrium behaviour is correct for a large range of timesteps.}
\end{figure}

\subsubsection{Testing the BD algorithm in one dimension}

Here we perform tests for two partcles in a 1D domain, again with one fixed at the origin. For reversible reactions, the product particle is always placed on the right side of the particle at the origin after a dissociation. In \fref{newBD2D_rdens_compare}, right, we performed simulations with a reversible reaction in a finite domain. We measure the time the particles are bound during a very long trajectory, and compare our result with theory for different values of the intrinsic association rate $k_a$. The results show that our algorithm correctly simulates the equilibrium behaviour. When we increase the timestep, the simulated dynamics becomes more and more incorrect, but the equilibrium behaviour is unchanged.

We also looked at the dynamics of the 1D system, similar as was done for the 2D system. Because there exists a Green's function for a reversible system in 1D, we compare the spatial probability densities for a system with and without a dissociation reaction with theory. Results and system parameters are given in \fref{newBD1D_rdens_compare}. Again the simulations are in good agreement with theory if we choose the timestep small enough. The reversible system shows an even better agreement with theory. The reason is that the dissociation rate is so high, we are effectively simulating a reflective system. Particles are immediately placed back into te system after a complex formation.

\begin{figure}[hb]
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{newBD1Dirr_rdens_compare}
\end{minipage}
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{newBD1Drev_rdens_compare}
\end{minipage}
\caption{\flabel{newBD1D_rdens_compare} Probability distribution for a irreversible (left) and reversible (right) reaction on a line (1D). Just as in the case for 2D, in both plots the four curves refer to different $t_{\rm sim}$, where the timestep for each curve is $\Delta t = 10^{-4} \tau$. Except for $t_{\rm sim}=10^{-1}\tau$, where $\Delta t=10^{-5}\tau$. Particles start at contact. The intrinsic association rate is $k_a=20 R/\tau$, and the decay rate for the reversible case is $k_d=4/\tau$. We compare our simulation results (symbols) with the Green's functions (lines) in 1D on a semi-infinite domain with a radiation (left, \cite{Beck1992}) or reversible (right, \cite{Agmon1984,Kim2001}) boundary condition at $x=0$. For larger timesteps, the algorithm underestimates the survival probability, as is clear in the inset of the irreversible plot. With a high dissociation rate however, the error in the survival probability is much less as is shown in the inset of the right figure.}
\end{figure}

\subsubsection{Comparing the algorithm with the algorithm by Morelli}
Here we compare our simulations done for the dynamics in a 1D system, with simulations done using the very similar algorithm by Morelli \cite{Morelli2008a}. Both simulations share the same parameters, apart for the reaction length $\delta$, which was set to $\delta=0.01R$. In \fref{BD1D_rdens_compare} we show the spatial probability densities for an reversible and irreversible system. An important difference is that the old Brownian dynamics algorithm seems to underestimate the survival probability more than the new algorithm. We looked at how this underestimation progresses in time in \fref{BD1DSsigma}, where we compare the theoretical survival probability $S_{\rm rad}(t|\sigma)$ with simulations done with the old and the new algorithm. Both algorithms underestimate the survival probability over the whole range of times we simulated. The inset in \fref{BD1DSsigma} shows that the relative error in the survival probability is larger for the old algorithm compared to the new one.

The performance of both algorithms is comparable. The most important difference with our algorithm, is that in the method of Morelli, the simulator needs to evaluate a numerical root finder in order to calculate the particle positions after dissociation. Only in systems where most steps are dissociation steps, there is a clear difference in performance between algorithms. Because in any realistic setup, most iterations are diffusion steps, both algorithms perform the same when measured in numbber of iterations per wall time.  

\begin{figure}[hb]
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{BD1Dirr_rdens_compare}
\end{minipage}
\begin{minipage}[ht]{.5\linewidth}
\centering
\includegraphics[scale=.5]{BD1Drev_rdens_compare}
\end{minipage}
\caption{\flabel{BD1D_rdens_compare} Comparison between our Brownian dynamics algorithm and the old algorithm by Morelli \cite{Morelli2008a}, for a 1D system. Parameters and setup are the same as described in \fref{newBD1D_rdens_compare}. Again, the right figure shows the probability density of an irreversible system and the left figure for a reversible system. The inset shows that the algorithm by Morelli (oldBD), underestimates the survival probability more than our algorithm (newBD). In the reversible case, there is liddle difference between theory and simulation.}
\end{figure}

\begin{figure}[hb]
\centering
\includegraphics[scale=1]{BD1DSsigma}
\caption{\flabel{BD1DSsigma} The irreversible survival probability as a function of time with one particle starting at contact. The timescale $\tau$ and lengthscale $R$ are as described earlier. We choose a timestep $\Delta t = 10^{-4} \tau$, and the intrinsic association rate $k_a=2 R/\tau$. We calculated the survival probability by simulating a million trajectories for each $t_{\rm sim}$, and recorded the fraction which has not reacted during that time. The plot shows the old and the new Brownian dynamics algorithms with the theoretical survival probability. Both algorithms underestime the survival probability for the whole range of times. The inset shows the relative error of the algorithm compared to the analytic result.}
\end{figure}